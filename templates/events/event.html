{% extends 'standard_sidebar.html' %}
{% block title %}{{ event.title }}{% endblock title %}
{% block text %}
    <img src="/uploads/{{ event.image }}" class="center-block img-responsive art-img">

    <h1 id="event_title">{{ event.title }}</h1>
    <h3 class="text-center">{{ event.ingress }}</h3>
    <h6 class="top-text">
        Av:
        <a class="userLink" id="{{ event.author }}"
           href="{% url 'profile' event.author.pk %}">{{ event.author.hybrid.get_full_name }}</a>
        {% if user.is_authenticated %}
            <a class="pull-right" href="{% url 'edit_event' event.pk %}">
                <button class="btn btn-xs btn-primary">Rediger</button>
            </a>

            <a class="pull-right" href="{% url 'delete_event' event.pk %}">
                <button class="btn btn-xs btn-danger">Slett</button>
            </a>
        {% endif %}
    </h6>
    <p class="text-center"></p>
    <p>{{ event.text|linebreaksbr }}</p>
    <p></p>


    <h6 class="top-text">Påmeldte</h6>

    <div class="col-md-12">

        <div class="row">
            <div class="col-md-1">
                0
            </div>
            <div class="col-md-11">
                <p onclick="$ ( '.showhide1' ).toggle ( ) ;" style="cursor: pointer;"> Klasse 1 </p>
            </div>
            <div style="display: none" class="showhide1" id="showhide1" name="showhide1">

            </div>
        </div>

        <div class="row">
            <div class="col-md-1">
                0
            </div>
            <div class="col-md-11">
                <p onclick="$ ( '.showhide2' ).toggle ( ) ;" style="cursor: pointer;"> Klasse 2 </p>
            </div>
            <div style="display: none" class="showhide2" id="showhide2" name="showhide2">

            </div>
        </div>

        <div class="row">
            <div class="col-md-1">
                0
            </div>
            <div class="col-md-11">
                <p onclick="$ ( '.showhide3' ).toggle ( ) ;" style="cursor: pointer;"> Klasse 3 </p>
            </div>
            <div style="display: none" class="showhide3" id="showhide3" name="showhide3">

            </div>
        </div>

        <div class="row">
            <div class="col-md-1">
                0
            </div>
            <div class="col-md-11">
                <p onclick="$ ( '.showhide4' ).toggle ( ) ;" style="cursor: pointer;"> Klasse 4 </p>
            </div>
            <div style="display: none" class="showhide4" id="showhide4" name="showhide4">

            </div>
        </div>

        <div class="row">
            <div class="col-md-1">
                0
            </div>
            <div class="col-md-11">
                <p onclick="$ ( '.showhide5' ).toggle ( ) ;" style="cursor: pointer;"> Klasse 5 </p>
            </div>
            <div style="display: none" class="showhide5" id="showhide5" name="showhide5">

            </div>
        </div>

    </div>
{% endblock text %}
{% block sidebar %}
    <table width="100%" class="info-table">
        <tbody>
        {% if event.signup_start %}
            <tr>
                <td>Åpnes</td>
                <td>{{ event.signup_start }}</td>
            </tr>
        {% endif %}
        {% if event.signup_end %}
            <tr>
                <td>Frist</td>
                <td>{{ event.signup_end }}</td>
            </tr>
        {% endif %}
        {% if event.event_start %}
            <tr>
                <td>Start</td>
                <td>{{ event.event_start }}</td>
            </tr>
        {% endif %}
        {% if event.event_end %}
            <tr>
                <td>Slutt</td>
                <td>{{ event.event_end }}</td>
            </tr>
        {% endif %}
        {% if event.location %}
            <tr>
                <td>Sted</td>
                <td>{{ event.location }}</td>
            </tr>
        {% endif %}
        </tbody>
    </table>
    <br>
    {% if event.max_participants %}
    <div class="progress">
        <div class="progress-bar"
             style="width: {% widthratio event.participants.count event.max_participants 100 %}%">
        </div>
        <span>
            {{ event.participants.count }} / {{ event.max_participants }}
        </span>
    </div>
    {% endif %}

    {% if user.is_authenticated %}
        <div class="row">
            <div class="col-md-12">
                {% if event.signup_open %}
                    {% if user in event.participants.all %}
                        <form method="post" action="{% url 'leave_event' event.pk %}">
                            {% csrf_token %}
                            <input name="eventId" value="{{ event.pk }}" type="hidden">
                            <button type="submit" class=" btn btn-danger btn-block">Meld meg av
                            </button>
                        </form>
                    {% else %}
                        <form method="post" action="{% url 'join_event' event.pk %}">
                            {% csrf_token %}
                            <input name="eventId" value="{{ event.pk }}" type="hidden">
                            <button type="submit" class=" btn btn-primary btn-block">Meld meg på
                            </button>
                        </form>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    {% endif %}
{% endblock sidebar %}
{% block extra %}
    <script type="text/javascript">
        textBox = $('#text-box');
        sidebar = $('#sidebar');
        adjust_height = function () {
            if (window.innerWidth >= 992) {
                $('#comment_box').css('max-height', textBox.height() - sidebar.height() - 30 + 'px');
            } else {
                $('#comment_box').css('max-height', "")
            }
        };
        window.onload = adjust_height;
        window.onresize = adjust_height;
    </script>
    <div class="col-md-4 space-above">
        <div class="white-box comment-section" id="comment_box" style="overflow-y: scroll">
            <h6 class="top-text">Kommentarer</h6>
            {% for comment in event.eventcomment_set.all %}
                <div class="row">
                    <div class="col-xs-2 col-lg-2" style="padding-right:0">
                        <a class="userThumbnailLink" id="{{ comment.author }}"
                           href="{% url 'profile' comment.author_id %}">
                            <img class="userThumbnail" src="/uploads/{{ comment.author.hybrid.image }}"
                                 alt="{{ comment.author_id }}">
                        </a>
                    </div>
                    <div class="col-xs-10 col-lg-10" style="padding-left:2.5%">
                        <div class="row">
                            <div class="col-xs-11">
                                <strong>
                                    <a class="userLink" id="{{ comment.author }}"
                                       href="{% url 'profile' comment.author_id %}">{{ comment.author.hybrid.get_full_name }}</a>:</strong>
                            </div>
                            {% if user == comment.author %}
                                <div class="col-xs-1" style="padding-left: 0;">
                                    <div class="btn-group pull-right">
                                        <button class="btn btn-default btn-xs dropdown-toggle" type="button"
                                                data-toggle="dropdown" aria-expanded="false">
                                            <span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-right" role="menu"
                                            style="min-width:0;padding:0;border:none;">
                                            <form method="POST" action="/comment/delete/1">
                                                <button type="submit" class="btn btn-sm btn-danger"> Slett</button>
                                            </form>
                                        </ul>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                {{ comment.text }}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <small>{{ comment.timestamp }}</small>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
            <div style="margin:1em">
                <form action="{% url 'comment_event' event.pk %}" method="POST">
                    {% csrf_token %}
                    <input name="event_id" value="{{ event.pk }}" hidden>
                    <label for="comment" class="sr-only">Comment:</label>
                    <input class="form-control" id="comment" name="text" autocomplete="off"
                           maxlength="250" type="text">
                    <button type="submit" class="btn btn-primary" style="width: 100%">Kommenter</button>
                </form>
            </div>
        </div>
    </div>
{% endblock extra %}
