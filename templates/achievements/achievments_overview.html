{% extends 'standard_wide.html' %}
{% block link%}
{% endblock %}
{% load static %}
{% block title %}Badges{% endblock %}
{% block text %}


    <h1 style="text-align: center; font-size: 60px;color: darkblue; margin-bottom: 10px;"> Tilgjenglige badges </h1>
    <p style="text-align: center; font-size: 35px;margin-bottom: 60px">  </p>


        <div class="row remove-whitebox-padding">

            <div class="col" style="background-color:#e9e9e9;margin-top: -2%;">
                <div style="margin-left: 1%; margin-right: 1%;">
                    <br>
                      {% for badge in Badges|dictsortreversed:"scorepoints"%}
                          <a data-toggle="modal" data-target="#exampleModal" onclick=setModalContent({{ badge.id }})>
                          <img title="Name: {{ badge.name }}
Description: {{ badge.description }}
Scorepoints: {{ badge.scorepoints }}" src="/uploads/{{ badge.badge_image }}" alt="Name: {{ badge.name }}" style="width: 18.5%;height: auto; margin-bottom: 1%;margin-left: 1%">
                          </a>
                      {% endfor %}
                    <br>
                </div>
            </div>
        </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <form method="POST">
                    {% csrf_token %}
                    <div class="modal-header">
                        <h5 class="modal-title" id="title-field">Modal title</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div id="modal-body">

                        </div>
                        <div id="form-container">
                            {{ form }}
                        </div>
                    </div>
                    <input type="hidden" name="badge-id" id="badge-id" value="-1">
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" id="submit-button" class="btn btn-primary">Søk om badge</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{%  endblock %}

{% block script %}
    <script>
        function setModalContent(badgeID) {
            $.ajax({
                // typing urls manually is bad practice, as it creates an issue if the url is changed
                // generally, use the builtin django url template tag, which uses url names
                // here, however, it is necessary to have the url "hardcoded" in
                url: `/achievements/badges/data/${badgeID}`,
                type: 'GET',
                success: function (badge) {
                    // if the user already has requested badge
                    if (badge.request) {
                        // get request
                        let request = badge.request;
                        // set title
                        document.getElementById("title-field").innerText = `Din søknad om ${badge.name}`;
                        // hide form
                        document.getElementById("form-container").style.display = 'none';
                        document.getElementById("submit-button").style.display = 'none';
                        // set modal contents
                        document.getElementById("modal-body").innerText = `Status: ${request["status"]}\n`
                            + `Din kommentar: ${request["comment"]}`;
                    } else if (badge.user_has) {
                        // set title
                        document.getElementById("title-field").innerText = `${badge.name}`;
                        // set modal contents
                        document.getElementById("modal-body").innerText = "Du har allerede denne badgen!";
                        // hide form
                        document.getElementById("form-container").style.display = 'none';
                        document.getElementById("submit-button").style.display = 'none';
                    } else {
                        // set title
                        document.getElementById("title-field").innerText = `Søk om å få tildelt ${badge.name}`;
                        // show form
                        document.getElementById("form-container").style.display = 'block';
                        document.getElementById("submit-button").style.display = 'inline-block';
                        document.getElementById("badge-id").setAttribute("value", badgeID);
                        // set modal contents
                        document.getElementById("modal-body").innerText = `Scorepoints: ${badge.scorepoints}\n`
                            + `Beskrivelse: ${badge.description}\n`
                            + `Vil du ha den?`;
                    }
                }
            });
        }
    </script>
{% endblock %}